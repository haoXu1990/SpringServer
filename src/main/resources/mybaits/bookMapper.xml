<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xh.HiXiaoshuoserver.mapper.BookMapper">

    <resultMap id="bookResultMap" type="com.xh.HiXiaoshuoserver.domain.Book">

        <result column="book_id" property="bookID"/>
        <result column="book_name" property="bookName"/>
        <result column="book_author" property="bookAuthor"/>
        <result column="book_status" property="bookStatus"/>
        <result column="book_classify" property="bookClassify"/>
        <result column="book_catetime" property="bookCreatTime"/>
        <result column="book_abstract" property="bookAbstract"/>
        <result column="book_imageurl" property="bookImageUrl"/>
    </resultMap>

    <sql id="Base_Column_bookList">
      book_name,book_author,book_status,book_classify,book_catetime,book_abstract,book_imageurl
    </sql>

    <sql id="Base_Jindian_Column_bookList">
      book_author,book_status,book_classify,book_catetime,book_abstract,book_imageurl
    </sql>

<!--根据点击排行获取获取小说列表-->
    <select id="findByPage" resultMap="bookResultMap" useCache="false">
        select p.*
        from (select books.book_id,
        <include refid="Base_Column_bookList"/>, (select book_clickcount from book_click_rank where book_id = books.book_id)
        as clickcount from books
        <where>

            <!--分类查询-->
            <if test="classify != null">
                books.book_classify = #{classify}
            </if>

            <!--男频-->
            <if test="male != null" >
                books.book_classify in ('玄幻魔法', '武侠修真', '侦探推理', '历史军事', '其他类型', '恐怖灵异','科幻小说', '网游动漫')
            </if>

            <!--女频-->
            <if test="female != null">
                books.book_classify in ('都市言情', '其他类型', '恐怖灵异', '穿越小说','散文诗词', '科幻小说')
            </if>
        </where>



        )
        as p order by p.clickcount desc
    </select>
    
    
    <select id="findByJinDian" resultMap="bookResultMap" useCache="false">
      select  books.book_id,
        <include refid="Base_Column_bookList"/> from books where books.book_id in (
        select book_id from (select * from book_jinpin order by rand() limit 8) as t)

    </select>

    <select id="findByJinDianPage" resultMap="bookResultMap" useCache="false">
        select  books.book_id,books.book_name,
        <include refid="Base_Jindian_Column_bookList"/> from books,book_jinpin where books.book_id = book_jinpin.book_id

    </select>


    <select id="findByNanShen" resultMap="bookResultMap" useCache="false">
        select  books.book_id,
        <include refid="Base_Column_bookList"/> from books where books.book_id in (
        select book_id from (select * from book_nanshen order by rand() limit 8) as t)

    </select>

    <select id="findByNanShenPage" resultMap="bookResultMap" useCache="false">
        select  books.book_id,books.book_name,
        <include refid="Base_Jindian_Column_bookList"/> from books,book_nanshen where books.book_id = book_nanshen.book_id

    </select>


    <select id="findByNvShen" resultMap="bookResultMap" useCache="false">
        select  books.book_id,
        <include refid="Base_Column_bookList"/> from books where books.book_id in (
        select book_id from (select * from book_nvshen order by rand() limit 8) as t)

    </select>

    <select id="findByNvShenPage" resultMap="bookResultMap" useCache="false">
        select  books.book_id,books.book_name,
        <include refid="Base_Jindian_Column_bookList"/> from books,book_nvshen where books.book_id = book_nvshen.book_id

    </select>

</mapper>